<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Mapping Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .card {
            transition: transform 0.2s;
            margin-bottom: 1rem;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .result-area {
            max-height: 400px;
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.25rem;
            margin-top: 1rem;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-5">Network Mapping Tool</h1>

        <!-- System Setup -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0"><i class="fas fa-cogs me-2"></i>System Setup</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-info" onclick="installRequirements()">
                    <i class="fas fa-download me-2"></i>Install Required Packages
                </button>
            </div>
        </div>

        <div class="row">
            <!-- Network Information -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0"><i class="fas fa-network-wired me-2"></i>Network Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" onclick="getInfo('local-ip')">
                                <i class="fas fa-laptop me-2"></i>Get Local IP
                            </button>
                            <button class="btn btn-outline-primary" onclick="getInfo('mac-address')">
                                <i class="fas fa-id-card me-2"></i>Get MAC Address
                            </button>
                            <button class="btn btn-outline-primary" onclick="getInfo('router-details')">
                                <i class="fas fa-router me-2"></i>Get Router Details
                            </button>
                            <button class="btn btn-outline-primary" onclick="getInfo('isp-info')">
                                <i class="fas fa-globe me-2"></i>Get ISP Information
                            </button>
                            <button class="btn btn-outline-primary" onclick="getInfo('connected-devices')">
                                <i class="fas fa-users me-2"></i>Get Connected Devices
                            </button>
                            <button class="btn btn-outline-primary" onclick="getInfo('connection-type')">
                                <i class="fas fa-wifi me-2"></i>Get Connection Type
                            </button>
                            <button class="btn btn-outline-primary" onclick="getInfo('check-anonymity')">
                                <i class="fas fa-user-secret me-2"></i>Check Anonymity
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Information -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0"><i class="fas fa-desktop me-2"></i>System Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-success" onclick="getInfo('system-info')">
                                <i class="fas fa-info-circle me-2"></i>Get System Information
                            </button>
                            <button class="btn btn-outline-success" onclick="getInfo('network-stats')">
                                <i class="fas fa-chart-line me-2"></i>Get Network Statistics
                            </button>
                            <button class="btn btn-outline-success" onclick="getInfo('disk-usage')">
                                <i class="fas fa-hdd me-2"></i>Get Disk Usage
                            </button>
                            <button class="btn btn-outline-success" onclick="getInfo('cpu-usage')">
                                <i class="fas fa-microchip me-2"></i>Monitor CPU Usage
                            </button>
                            <button class="btn btn-outline-success" onclick="getInfo('auth-logs')">
                                <i class="fas fa-shield-alt me-2"></i>Parse Authentication Logs
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Scanning -->
        <div class="card mt-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0"><i class="fas fa-search me-2"></i>Advanced Scanning</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Target Scan</h6>
                        <div class="form-group">
                            <input type="text" id="scanTarget" class="form-control" placeholder="Enter target IP or domain">
                        </div>
                        <button class="btn btn-warning" onclick="scanTarget()">
                            <i class="fas fa-search me-2"></i>Scan Target
                        </button>
                    </div>
                    <div class="col-md-6">
                        <h6>SSH Connection</h6>
                        <div class="form-group">
                            <input type="text" id="sshHost" class="form-control mb-2" placeholder="Hostname">
                            <input type="text" id="sshUser" class="form-control mb-2" placeholder="Username">
                            <input type="password" id="sshPass" class="form-control mb-2" placeholder="Password">
                            <input type="text" id="sshKey" class="form-control mb-2" placeholder="Key file path (optional)">
                        </div>
                        <button class="btn btn-warning" onclick="sshConnect()">
                            <i class="fas fa-terminal me-2"></i>Connect SSH
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Attack Simulation -->
        <div class="card mt-4">
            <div class="card-header bg-danger text-white">
                <h5 class="card-title mb-0"><i class="fas fa-shield-virus me-2"></i>Network Attack Simulation</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Network Discovery</h6>
                        <button class="btn btn-outline-danger mb-3" onclick="discoverHosts()">
                            <i class="fas fa-search me-2"></i>Discover Network Hosts
                        </button>
                        <div id="hostsList" class="mb-3"></div>
                    </div>
                    <div class="col-md-6">
                        <h6>Attack Simulation</h6>
                        <div class="form-group mb-3">
                            <label>Select Attack Type:</label>
                            <select id="attackType" class="form-select mb-2">
                                <option value="">Choose an attack...</option>
                            </select>
                            <button class="btn btn-outline-danger" onclick="getRandomAttack()">
                                <i class="fas fa-random me-2"></i>Random Attack
                            </button>
                        </div>
                        <div class="form-group mb-3">
                            <label>Target IP:</label>
                            <input type="text" id="targetIp" class="form-control" placeholder="Enter target IP">
                        </div>
                        <button class="btn btn-danger" onclick="simulateAttack()">
                            <i class="fas fa-play me-2"></i>Start Attack
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comprehensive Network Mapping -->
        <div class="card mt-4">
            <div class="card-header bg-dark text-white">
                <h5 class="card-title mb-0"><i class="fas fa-network-wired me-2"></i>Comprehensive Network Mapping</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Network Range Scan</h6>
                        <div class="form-group mb-3">
                            <label>Network Range:</label>
                            <input type="text" id="networkRange" class="form-control" placeholder="e.g., 192.168.1.0/24">
                            <small class="text-muted">Enter CIDR notation or IP range</small>
                        </div>
                        <button class="btn btn-dark" onclick="scanNetwork()">
                            <i class="fas fa-search me-2"></i>Scan Network
                        </button>
                    </div>
                    <div class="col-md-6">
                        <h6>Vulnerability Assessment</h6>
                        <div class="form-group mb-3">
                            <label>Target Host:</label>
                            <input type="text" id="vulnTarget" class="form-control" placeholder="Enter target IP">
                        </div>
                        <button class="btn btn-dark" onclick="scanVulnerabilities()">
                            <i class="fas fa-shield-virus me-2"></i>Scan Vulnerabilities
                        </button>
                    </div>
                </div>
                <div class="mt-4">
                    <h6>Scan Results</h6>
                    <div id="scanResults" class="result-area"></div>
                </div>
            </div>
        </div>

        <!-- Vulnerability Results Section -->
        <div class="card mt-4" id="vulnerabilityResults" style="display: none;">
            <div class="card-header bg-danger text-white">
                <h5 class="card-title mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Vulnerability Findings</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="alert alert-warning">
                            <h6>Summary</h6>
                            <p id="vulnSummary"></p>
                        </div>
                        <div id="vulnFindings"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Area -->
        <div class="card mt-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="card-title mb-0"><i class="fas fa-terminal me-2"></i>Results</h5>
            </div>
            <div class="card-body">
                <div class="loading">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
                <div id="result" class="result-area"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function getInfo(type) {
            const resultArea = document.getElementById('result');
            const loading = document.querySelector('.loading');

            loading.style.display = 'block';
            resultArea.innerHTML = '';

            try {
                const response = await fetch(`/api/${type}`);
                const data = await response.json();

                if (typeof data === 'object') {
                    resultArea.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultArea.innerHTML = `<pre>${data}</pre>`;
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function installRequirements() {
            const resultArea = document.getElementById('result');
            const loading = document.querySelector('.loading');

            loading.style.display = 'block';
            resultArea.innerHTML = '';

            try {
                const response = await fetch('/api/install-requirements');
                const data = await response.json();

                resultArea.innerHTML = `<div class="alert ${data.success ? 'alert-success' : 'alert-danger'}">
                    <i class="fas ${data.success ? 'fa-check-circle' : 'fa-exclamation-circle'} me-2"></i>
                    ${data.message}
                </div>`;
            } catch (error) {
                resultArea.innerHTML = `<div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    Error: ${error.message}
                </div>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function scanTarget() {
            const target = document.getElementById('scanTarget').value;
            if (!target) {
                alert('Please enter a target');
                return;
            }

            const resultArea = document.getElementById('result');
            const loading = document.querySelector('.loading');

            loading.style.display = 'block';
            resultArea.innerHTML = '';

            try {
                const response = await fetch('/api/scan-target', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ target }),
                });
                const data = await response.json();

                if (data.error) {
                    resultArea.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                } else {
                    let html = `
                        <div class="alert alert-success">
                            <h5>Scan Results for ${target}</h5>
                            <p>Scan Time: ${new Date(data.timestamp).toLocaleString()}</p>
                        </div>`;

                    // Display ports
                    if (data.ports && Object.keys(data.ports).length > 0) {
                        html += `
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Open Ports</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group">`;

                        for (const [port, info] of Object.entries(data.ports)) {
                            html += `
                                <li class="list-group-item">
                                    <strong>Port ${port}:</strong> ${info.service}
                                    <br><small>State: ${info.state}</small>
                                    ${info.banner ? `<br><small>Banner: ${info.banner}</small>` : ''}
                                </li>`;
                        }

                        html += `
                                    </ul>
                                </div>
                            </div>`;
                    }

                    // Display OS information
                    if (data.os_info) {
                        html += `
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Operating System Information</h6>
                                </div>
                                <div class="card-body">
                                    <pre>${JSON.stringify(data.os_info, null, 2)}</pre>
                                </div>
                            </div>`;
                    }

                    // Display vulnerabilities if any
                    if (data.vulnerabilities && data.vulnerabilities.length > 0) {
                        html += `
                            <div class="card mb-3">
                                <div class="card-header bg-danger text-white">
                                    <h6 class="mb-0">Vulnerabilities Found</h6>
                                </div>
                                <div class="card-body">`;

                        data.vulnerabilities.forEach(vuln => {
                            html += `
                                <div class="alert alert-warning">
                                    <h6>${vuln.description}</h6>
                                    <p class="mb-1"><small>Type: ${vuln.type}</small></p>
                                    ${vuln.severity ? `<p class="mb-1"><small>Severity: ${vuln.severity}</small></p>` : ''}
                                </div>`;
                        });

                        html += `
                                </div>
                            </div>`;
                    }

                    resultArea.innerHTML = html;
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function sshConnect() {
            const hostname = document.getElementById('sshHost').value;
            const username = document.getElementById('sshUser').value;
            const password = document.getElementById('sshPass').value;
            const key_filename = document.getElementById('sshKey').value;

            if (!hostname || !username) {
                alert('Please enter hostname and username');
                return;
            }

            const resultArea = document.getElementById('result');
            const loading = document.querySelector('.loading');

            loading.style.display = 'block';
            resultArea.innerHTML = '';

            try {
                const response = await fetch('/api/ssh-connect', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        hostname,
                        username,
                        password: password || undefined,
                        key_filename: key_filename || undefined,
                    }),
                });
                const data = await response.json();
                resultArea.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                resultArea.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function discoverHosts() {
            const resultArea = document.getElementById('hostsList');
            const loading = document.querySelector('.loading');

            loading.style.display = 'block';
            resultArea.innerHTML = '';

            try {
                const response = await fetch('/api/discover-hosts');
                const data = await response.json();

                if (data.hosts && data.hosts.length > 0) {
                    let html = '<div class="list-group">';
                    data.hosts.forEach(host => {
                        html += `
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">${host.hostname || 'Unknown'}</h6>
                                        <small>IP: ${host.ip}</small>
                                    </div>
                                    <button class="btn btn-sm btn-outline-danger" onclick="setTargetIp('${host.ip}')">
                                        <i class="fas fa-crosshairs"></i> Select
                                    </button>
                                </div>
                            </div>`;
                    });
                    html += '</div>';
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="alert alert-info">No hosts found</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function loadAttackTypes() {
            try {
                const response = await fetch('/api/attack-types');
                const data = await response.json();

                const select = document.getElementById('attackType');
                select.innerHTML = '<option value="">Choose an attack...</option>';

                Object.entries(data).forEach(([key, value]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = value.name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to load attack types:', error);
            }
        }

        async function getRandomAttack() {
            try {
                const response = await fetch('/api/random-attack');
                const data = await response.json();
                document.getElementById('attackType').value = data.attack_type;
            } catch (error) {
                console.error('Failed to get random attack:', error);
            }
        }

        function setTargetIp(ip) {
            document.getElementById('targetIp').value = ip;
        }

        async function simulateAttack() {
            const attackType = document.getElementById('attackType').value;
            const targetIp = document.getElementById('targetIp').value;
            const resultArea = document.getElementById('result');
            const loading = document.querySelector('.loading');

            if (!attackType || !targetIp) {
                alert('Please select an attack type and enter a target IP');
                return;
            }

            loading.style.display = 'block';
            resultArea.innerHTML = '';

            try {
                const response = await fetch('/api/simulate-attack', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        attack_type: attackType,
                        target_ip: targetIp
                    }),
                });
                const data = await response.json();

                if (data.error) {
                    resultArea.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                } else {
                    resultArea.innerHTML = `
                        <div class="alert alert-success">
                            <h5>Attack Simulation Complete</h5>
                            <p>Type: ${data.attack_type}</p>
                            <p>Target: ${data.target_ip}</p>
                            <p>Duration: ${data.duration.toFixed(2)}s</p>
                            <pre>${data.output}</pre>
                        </div>`;
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        function displayVulnerabilities(data) {
            const vulnSection = document.getElementById('vulnerabilityResults');
            const vulnSummary = document.getElementById('vulnSummary');
            const vulnFindings = document.getElementById('vulnFindings');

            vulnSection.style.display = 'block';

            // Display summary
            vulnSummary.innerHTML = `
                <p>Total Findings: ${data.findings.length}</p>
                <p>Target: ${data.target}</p>
                <p>Scan Time: ${new Date(data.timestamp).toLocaleString()}</p>
            `;

            // Display findings
            let findingsHtml = '<div class="row">';

            // Group findings by severity
            const findingsBySeverity = {
                'High': [],
                'Medium': [],
                'Low': [],
                'Info': []
            };

            data.findings.forEach(finding => {
                const severity = finding.severity || 'Info';
                findingsBySeverity[severity].push(finding);
            });

            // Display findings by severity
            Object.entries(findingsBySeverity).forEach(([severity, findings]) => {
                if (findings.length > 0) {
                    findingsHtml += `
                        <div class="col-md-12 mb-3">
                            <div class="card border-${getSeverityColor(severity)}">
                                <div class="card-header bg-${getSeverityColor(severity)} text-white">
                                    <h6 class="mb-0">${severity} Severity Issues (${findings.length})</h6>
                                </div>
                                <div class="card-body">`;

                    findings.forEach(finding => {
                        findingsHtml += `
                            <div class="mb-3">
                                <h6>${finding.description}</h6>
                                <p class="mb-1"><small>Type: ${finding.type}</small></p>
                                ${finding.port ? `<p class="mb-1"><small>Port: ${finding.port}</small></p>` : ''}
                                ${finding.service ? `<p class="mb-1"><small>Service: ${finding.service}</small></p>` : ''}
                                ${finding.os ? `<p class="mb-1"><small>OS: ${finding.os}</small></p>` : ''}
                            </div>`;
                    });

                    findingsHtml += `
                                </div>
                            </div>
                        </div>`;
                }
            });

            findingsHtml += '</div>';
            vulnFindings.innerHTML = findingsHtml;
        }

        function getSeverityColor(severity) {
            switch(severity.toLowerCase()) {
                case 'high':
                    return 'danger';
                case 'medium':
                    return 'warning';
                case 'low':
                    return 'info';
                default:
                    return 'secondary';
            }
        }

        async function scanVulnerabilities() {
            const target = document.getElementById('vulnTarget').value;
            if (!target) {
                alert('Please enter a target IP');
                return;
            }

            const loading = document.querySelector('.loading');
            loading.style.display = 'block';

            try {
                const response = await fetch('/api/scan-vulnerabilities', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ target }),
                });
                const data = await response.json();

                if (data.error) {
                    alert(data.error);
                } else {
                    displayVulnerabilities(data);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            } finally {
                loading.style.display = 'none';
            }
        }

        async function scanNetwork() {
            const networkRange = document.getElementById('networkRange').value;
            if (!networkRange) {
                alert('Please enter a network range');
                return;
            }

            const loading = document.querySelector('.loading');
            loading.style.display = 'block';

            try {
                const response = await fetch('/api/scan-network', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ network_range: networkRange }),
                });
                const data = await response.json();

                if (data.error) {
                    alert(data.error);
                } else {
                    // Display network scan results
                    displayNetworkResults(data);

                    // Display vulnerabilities for each host
                    Object.values(data.hosts).forEach(host => {
                        if (host.vulnerabilities && host.vulnerabilities.length > 0) {
                            displayVulnerabilities({
                                target: host.ip,
                                timestamp: data.timestamp,
                                findings: host.vulnerabilities
                            });
                        }
                    });
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            } finally {
                loading.style.display = 'none';
            }
        }

        // Load attack types when the page loads
        document.addEventListener('DOMContentLoaded', loadAttackTypes);
    </script>
</body>
</html>
